// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

var Config = require("./Config.bs.js");
var Express = require("express");
var Process = require("process");
var Belt_Option = require("rescript/lib/js/belt_Option.js");
var PromClient = require("prom-client");
var Yargs = require("yargs/yargs");
var EventSyncing = require("./EventSyncing.bs.js");
var Helpers = require("yargs/helpers");
var RegisterHandlers = require("./RegisterHandlers.bs.js");

globalThis.fetch = require('node-fetch')
;

RegisterHandlers.registerAllHandlers(undefined);

var app = Express();

app.use(Express.json());

app.get("/healthz", (function (_req, res) {
        res.sendStatus(200);
      }));

app.listen(Config.metricsPort);

PromClient.collectDefaultMetrics(undefined);

app.get("/metrics", (function (_req, res) {
        res.set("Content-Type", PromClient.register.contentType);
        PromClient.register.metrics().then(function (metrics) {
              return res.end(metrics);
            });
      }));

function main(param) {
  var mainArgs = Yargs(Helpers.hideBin(Process.argv)).argv;
  EventSyncing.startSyncingAllEvents(Belt_Option.getWithDefault(mainArgs["sync-from-raw-events"], false));
}

main(undefined);

var port = Config.metricsPort;

exports.app = app;
exports.port = port;
exports.main = main;
/*  Not a pure module */
